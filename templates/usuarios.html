{% extends 'layout.html' %}

{% block titulo %}Usuarios{% endblock %}

{% block contenido %}
<style>
    /* Estilos generales */
    div.tablo {
        margin: 2vh auto;
    }
    h1 {
        padding: 30px 0 !important;
    }
    table {
        padding: 8vh;
        width: 100%;
        overflow-x: auto;
    }
    table, thead, th, td {
        border: 1px solid black;
        text-align: center;
    }
    thead, th {
        background-color: #c1c1c1 !important;
    }
    .container {
        width: 100%;
        padding: 0;
    }
    .modal-dialog {
        max-width: 90%;
    }
    
    /* Media query para pantallas pequeñas */
    @media (max-width: 768px) {
        /* Asegurar que el encabezado sea más pequeño en pantallas pequeñas */
        h1 {
            font-size: 1.5rem;
            padding: 20px 0 !important;
        }
    
        /* Ajustar tabla */
        table {
            padding: 2vh;
            width: 100%;
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        table th, table td {
            font-size: 0.9rem;  /* Hacer la fuente más pequeña para móviles */
        }
    
        /* Modal y botones */
        .modal-content {
            padding: 1rem;
        }
    
        .modal-header h1 {
            font-size: 1.2rem;
        }
    
        /* Botones en la tabla (más pequeños) */
        .btn {
            font-size: 0.8rem;
            padding: 0.5vh 2vh;
        }
        
        .form-floating input, .form-floating select {
            font-size: 0.9rem;
        }
    }
    
    /* Estilo para la tabla de usuarios y la sección de la tabla */
    .tablo {
        width: 100%;
        margin: 0;
    }
    
    /* Estilos para los modales */
    .modal-footer {
        display: flex;
        justify-content: space-between;
    }
    
    /* Estilos para los botones en la tabla */
    button {
        padding: 0.5vh 1vh;
        border-radius: 5px;
        cursor: pointer;
    }
    
    /* Asegurarse de que los botones estén centrados */
    button[type="button"].btn-close {
        margin-top: 10px;
    }
    .form-control{
        width: 100% !important;
    }
    .formularito{
        margin: auto;
        width: 40%;
    }
</style>

<div class="container">

    {% with mensajes = get_flashed_messages() %}
    {% if mensajes %}
    {% for m in mensajes %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{m}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="tablo">
        <h1 style="border-top: 5px solid black; border-right: 5px solid black; border-left: 5px solid black; text-align: center; font-family: 'Silkscreen'; color: white; background-color: rgb(73, 39, 12); border-radius: 100% 100% 0 0;">Tabla de Usuarios</h1>
        
        <!-- Modal insert -->
        <div class="modal fade" id="insert" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="margin: auto; width: fit-content;">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel" style="text-align: center; margin-right: 9vw; color: black; font-size: 6vw;">Agrega un Usuario</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form class="formularito" action="/iUsuario" method="post">
                        <div class="modal-body">
                            <div class="form-floating mb-3">
                                <input type="text" name="nombre" class="form-control" id="floatingInputo" placeholder="TU mama perez">
                                <label for="floatingInput">Nombre completo</label>
                            </div>
                            
                                <div class="form-floating mb-3">
                                    <input type="email" name="correo" class="form-control" id="floatingInput" placeholder="name@example.com">
                                    <label for="floatingInput">Correo</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="password" name="clave" class="form-control" id="floatingPassword" placeholder="Password">
                                    <label for="floatingPassword">Contraseña</label>
                                </div>
                            
                            <div class="form-floating mb-3">
                                <select name="perfil" class="form-select" aria-label="Default select example">
                                    <option selected disabled>Selecciona un perfil</option>
                                    <option value="A">Administrador</option>
                                    <option value="U">Usuario</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Crear Usuario</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div style="background-color: rgb(73, 39, 12); padding: 4vh; border-bottom: 5px solid black; border-right: 5px solid black; border-left: 5px solid black;">
            <div style="background-color: white;padding: 2vh;">
                <table class="table" style="min-height: 40vh;">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Correo</th>
                            <th scope="col">Fecha de Registro</th>
                            <th scope="col">Perfil</th>
                            <th scope="col" colspan="2">
                                <!-- Button  -->
                                <button type="button" style=" background-color: ghostwhite; padding: .5vh 5vh; text-align: center; border-radius: 5px;" data-bs-toggle="modal" data-bs-target="#insert">
                                    <i class="fa-solid fa-user-plus"></i>
                                </button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in usuarios %}
                        <tr>
                            <th scope="row">{{u.0}}</th>
                            <td>{{u.1}}</td>
                            <td>{{u.2}}</td>
                            <td>{{u.4}}</td>
                            <td>{{u.5}}</td>
                            <td>
                                <!-- Button Update -->
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#update{{u.0}}">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                            </td> 
                            <td>
                                <!-- Button Delete -->
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete{{u.0}}">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </td>
                        </tr>

                        <!-- Modal Update -->
                        <div class="modal fade" id="update{{u.0}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="width: fit-content; margin: auto;">
                                        <h1 class="modal-title fs-5" id="staticBackdropLabel" style="margin-right: 9vw;">Editar Usuario</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form class="formularito" action="/uUsuario/{{u.0}}" method="post" style="width: 90%; margin: auto;">
                                        <div class="modal-body">
                                            <div class="form-floating mb-3">
                                                <input type="text" name="nombre" value="{{u.1}}" class="form-control" id="floatingInputo" placeholder="TU mama perez">
                                                <label for="floatingInput">Nombre completo</label>
                                            </div>
                                            <div class="form-floating mb-3">
                                                <input type="email" name="correo" value="{{u.2}}" class="form-control" id="floatingInput" placeholder="name@example.com">
                                                <label for="floatingInput">Correo</label>
                                            </div>
                                            <div class="form-floating mb-3">
                                                <input type="password" name="clave" class="form-control" id="floatingPassword" placeholder="Password">
                                                <label for="floatingPassword">Contraseña</label>
                                            </div>
                                            <div class="form-floating mb-3">
                                                <select name="perfil" class="form-select" aria-label="Default select example">
                                                    <option>Selecciona un perfil</option>
                                                    <option {% if u.5=='A' %} selected {% endif %} value="A">Administrador</option>
                                                    <option {% if u.5=='U' %} selected {% endif %} value="U">Usuario</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-primary">Actualizar Usuario</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <style>
                            .pou{
                                text-align: center !important;
                                
                            }
                        </style>
                        <!-- Modal Delete -->
                        <div class="modal fade" id="delete{{u.0}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="display: flex; justify-content: center;">
                                        <h1 class="pou" id="exampleModalLabel" style="text-align: center; margin: auto;">Eliminar Usuario</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form action="/dUsuario/{{u.0}}" method="post">
                                        <div class="modal-body">
                                            <p style="color: #f02400; text-align: center; font-size: 2vw;"><i class="fa-solid fa-triangle-exclamation pou"></i>¿Deseas Eliminar al Usuario <span style="color: black;">{{u.1}}</span>?</p>
                                        </div>
                                        <div class="modal-footer" style="padding: 6vw; text-align: center;">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-danger">Eliminar Usuario</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}
